<!--pages/transpose/transpose.wxml-->
<view class="container {{systemInfo.isIPhoneX ? 'iphone-x-safe-area' : ''}}">
  <!-- è¾“å…¥åŒºåŸŸ -->
  <view class="adaptive-card">
    <view class="adaptive-card-header">
      <text class="adaptive-card-title">å’Œå¼¦è¿›è¡Œè¾“å…¥</text>
    </view>
    <view class="adaptive-card-content">
      <view class="form-group">
        <input 
          class="form-input" 
          placeholder="ä¾‹å¦‚ï¼š4 5 3 6 2 5 1" 
          value="{{progression}}"
          bindinput="onProgressionInput"
          confirm-type="done"
        />
      </view>
      
      <view class="responsive-grid responsive-grid-2">
        <view class="grid-item">
          <view class="form-group">
            <text class="form-label">æºè°ƒ</text>
            <picker 
              mode="selector" 
              range="{{keys}}" 
              value="{{sourceKeyIndex}}"
              bindchange="onSourceKeyChange"
            >
              <view class="form-select">{{keys[sourceKeyIndex]}}</view>
            </picker>
          </view>
        </view>
        
        <view class="grid-item">
          <view class="form-group">
            <text class="form-label">ç›®æ ‡è°ƒ</text>
            <picker 
              mode="selector" 
              range="{{keys}}" 
              value="{{targetKeyIndex}}"
              bindchange="onTargetKeyChange"
            >
              <view class="form-select">{{keys[targetKeyIndex]}}</view>
            </picker>
          </view>
        </view>
      </view>
      
      <view class="responsive-grid responsive-grid-2">
        <view class="grid-item">
          <view class="form-group">
            <label class="form-label">
              <switch checked="{{isMinor}}" bindchange="onMinorChange" />
              <text style="margin-left: 16rpx;">å°è°ƒ</text>
            </label>
          </view>
        </view>
        
        <view class="grid-item">
          <view class="form-group">
            <label class="form-label">
              <switch checked="{{useSeventhChords}}" bindchange="onSeventhChange" />
              <text style="margin-left: 16rpx;">ä¸ƒå’Œå¼¦</text>
            </label>
          </view>
        </view>
      </view>
      
      <view class="responsive-grid responsive-grid-2">
        <button 
          class="adaptive-button adaptive-button-primary adaptive-button-{{buttonSize}}"
          bindtap="transposeChords"
          disabled="{{!progression.trim()}}"
        >
          ğŸ”„ è½¬è°ƒ
        </button>
        <button 
          class="adaptive-button adaptive-button-outline adaptive-button-{{buttonSize}}"
          bindtap="clearInput"
        >
          ğŸ—‘ï¸ æ¸…ç©º
        </button>
      </view>
    </view>
  </view>

  <!-- å¸¸ç”¨è¿›è¡Œ -->
  <view class="adaptive-card">
    <view class="adaptive-card-header">
      <text class="adaptive-card-title">å¸¸ç”¨èµ°å‘</text>
    </view>
    <view class="adaptive-card-content">
      <view class="progression-grid">
        <view 
          wx:for="{{commonProgressions}}" 
          wx:key="label"
          class="progression-tag"
          bindtap="fillProgression"
          data-value="{{item.value}}"
        >
          {{item.label}}
        </view>
      </view>
      
      <view wx:if="{{recentProgressions.length > 0}}" style="margin-top: 30rpx;">
        <text class="form-label">æœ€è¿‘ä½¿ç”¨</text>
        <view class="progression-grid">
          <view 
            wx:for="{{recentProgressions}}" 
            wx:key="*this"
            class="progression-tag recent"
            bindtap="fillProgression"
            data-value="{{item}}"
          >
            {{item}}
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- è½¬æ¢ç»“æœ -->
  <view wx:if="{{result.success && result.data.length > 0}}" class="adaptive-card">
    <view class="adaptive-card-header">
      <text class="adaptive-card-title">è½¬æ¢ç»“æœ</text>
      <button 
        class="adaptive-button adaptive-button-text adaptive-button-small"
        bindtap="copyResult"
      >
        ğŸ“‹ å¤åˆ¶
      </button>
    </view>
    <view class="adaptive-card-content">
      <view class="chord-display">
        <view 
          wx:for="{{result.data}}" 
          wx:key="index"
          class="chord-tag"
        >
          {{item.chord}}
        </view>
      </view>
      
      <button 
        class="adaptive-button adaptive-button-text adaptive-button-{{buttonSize}}"
        bindtap="toggleComparison"
      >
        {{showComparison ? 'éšè—' : 'æ˜¾ç¤º'}}å¯¹ç…§
      </button>
      
      <view wx:if="{{showComparison}}" class="comparison-list" style="margin-top: 20rpx;">
        <view 
          wx:for="{{result.data}}" 
          wx:key="index"
          class="comparison-item"
        >
          <text class="comparison-original">{{item.original}}</text>
          <text class="comparison-arrow">â†’</text>
          <text class="comparison-target">{{item.chord}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- é”™è¯¯æç¤º -->
  <view wx:if="{{!result.success && progression.trim()}}" class="adaptive-card">
    <view class="adaptive-card-content">
      <view class="error-message">{{result.error}}</view>
    </view>
  </view>
</view>