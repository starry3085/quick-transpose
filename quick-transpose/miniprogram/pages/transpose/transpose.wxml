<!--pages/transpose/transpose.wxml-->
<view class="container">
  <!-- 输入卡片 -->
  <view class="card">
    <view class="card-header">
      <text class="card-title">和弦进行输入</text>
    </view>
    <view class="card-content">
      <view class="input-group">
        <text class="label">和弦进行（数字）</text>
        <input 
          class="input" 
          placeholder="例如：4 5 3 6 2 5 1"
          value="{{progression}}"
          bindinput="onProgressionInput"
          confirm-type="done"
        />
      </view>
      
      <view class="row">
        <view class="col">
          <text class="label">源调</text>
          <picker 
            range="{{keys}}" 
            value="{{sourceKeyIndex}}"
            bindchange="onSourceKeyChange"
          >
            <view class="picker">{{sourceKey}}</view>
          </picker>
        </view>
        
        <view class="col">
          <text class="label">目标调</text>
          <picker 
            range="{{keys}}" 
            value="{{targetKeyIndex}}"
            bindchange="onTargetKeyChange"
          >
            <view class="picker">{{targetKey}}</view>
          </picker>
        </view>
      </view>
      
      <view class="switch-group">
        <text class="switch-label">小调模式</text>
        <switch 
          checked="{{isMinor}}" 
          bindchange="onMinorToggle"
          color="#10B981"
        />
      </view>
    </view>
  </view>

  <!-- 常用走向 -->
  <view class="card">
    <view class="card-header">
      <text class="card-title">常用走向</text>
    </view>
    <view class="card-content">
      <view class="progression-buttons">
        <block wx:for="{{commonProgressions}}" wx:key="label">
          <button 
            class="btn btn-outline btn-small" 
            bindtap="fillProgression"
            data-value="{{item.value}}"
          >
            {{item.label}}
          </button>
        </block>
      </view>
    </view>
  </view>

  <!-- 结果显示 -->
  <view class="card" wx:if="{{result.length > 0}}">
    <view class="card-header">
      <text class="card-title">转换结果</text>
      <button class="btn btn-primary btn-small" bindtap="copyResult">
        复制
      </button>
    </view>
    <view class="card-content">
      <view class="result-chords">
        <block wx:for="{{result}}" wx:key="index">
          <view class="chord-item">
            <view class="badge">{{item.chord}}</view>
            <text class="text-small text-gray">{{item.roman}}</text>
          </view>
        </block>
      </view>
    </view>
  </view>

  <!-- 对照表 -->
  <view class="card" wx:if="{{result.length > 0}}">
    <view class="card-header">
      <text class="card-title">原调→目标调对照</text>
    </view>
    <view class="card-content">
      <view class="comparison-list">
        <block wx:for="{{result}}" wx:key="index">
          <view class="comparison-item">
            <text class="original">{{item.original}}</text>
            <text class="arrow">→</text>
            <text class="target">{{item.chord}}</text>
          </view>
        </block>
      </view>
    </view>
  </view>
</view>